%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Master Thesis - Computer Engineering
%% Copyright 2009 Ricardo Alexandre Fiorelli, Erick Poletto
%% This document is distributed by the terms of the license
%% included in the file LICENCE.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Fourth Chapter
%% Analysis and Results
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Analysis and Results} \label{chap4:analysis_results}
%TODO explicar o que Ã© este capitulo, pra que ele serve, realmente PROCURAR na internet o que geralmente se coloca num capitulo assim
%TODO estudar e escrever o que aprendeu
%
    The objective of this chapter is to describe the designed components' database and evaluate it in comparison with measured data and data obtained from the components' manufacturer. The result of this evaluation will determine the adequacy of power consumption data provided by the database as a way to estimate the power consumption of different machine configurations.
    
\section{Analysis} \label{sec4:analysis}

\subsection{Component's Database} \label{sec4:component_database}
    The component's database will be described in terms of its relations. For each relation its semantic meaning will be explained along with the included data and the source of this data. The database schema is present in Appendix~\ref{app:database_schema}.

    \subsubsection*{Relations: Classification}
        Four relations were create in order to classify the components in different ways. These relations are 1CAT, 2CAT, 3CAT and DEVICE. In this hierarchical disposition each component is classified in three levels by the relations 1CAT, 2CAT and 3CAT and then uniquely identified by the DEVICE relation. This classification follows the one present in the website analyzed by the crawler.


        \paragraph*{Relation 1CAT}
            This is the first level of classification and is a general one, because it just states the final usage of the component. As the components used in the database are computer components they will be defined like that in this first level.

        \paragraph*{Relation 2CAT}
            This relation fits the component into one of the main devices of a computer architecture. These are the following: processors, main memory, mass storage device, networking devices, CD/DVD player, main board, etc.

        \paragraph*{Relation 3CAT}
            The component is classified in the last level to provide contextual information about its usage. Processors, for example, are defined either as boxed or directly available in an OEM computer configuration. Memory can be used for servers, workstations or notebooks. Network devices can be LAN cards or networking equipment such as routers. Finally, mass storage devices are separated by technology, which can be hard-disk or flash-based.

        \paragraph*{Relation DEVICE}
            The last level of these categories is the identification of each component by an unique MPN code. This is the central relation in the database connecting pricing, benchmark and characteristic relations associated to specific components. The MPN information stored here was obtained with the use of the WEBSPHINX crawler over the SiSoftware shopping site. This device relation uses MPN as its key and associates for each component the three previous classifications, the component model/name and the date in which it was inserted in the database.
            
    \subsubsection*{Relations: Characteristics}
        This set of relations associates each component with its specifications, provided by the manufacturer. As SiSoftware Sandra provides these, it was the preferred source for this kind of data. Other sources such as CPU-Z reports and component datasheets were used in case the information could not be found in Sandra.         

        \paragraph*{Relation DEVICE\_CHARACTERISTIC}
            This determines the value of the characteristic being described. The value in CHAR\_VALUE can be for example number of cores or clock frequency for a processor, disk rotation or average bandwidth for a hard drive or size and bandwidth for main memory. The attribute CHAR\_ID is linked to the following relation in order to define the type of the characteristic.
            
        \paragraph*{Relation CHARACTERISTIC}
            Each characteristic, other than a value associated in the previous relation, should be described in terms of type and measurement unit. One example may be the clock frequency which is measured in MHz. In this relation the attribute CHAR\_NAME would be ``clock frequency'', the attribute CHAR\_UM would be ``MHz'' and the DESCRIPTION attribute would explain the meaning of the characteristic.
            
        \paragraph*{Relation SOURCE}
            For each component, the source is the location from which the information was retrieved. It may be, for instance, SiSoftware Sandra, the web or other softwares such as CPU-Z.
            
    \subsubsection*{Benchmark Relations}
        In SANDRA there were two types of benchmarks analyzed: single-value or graph-based. Single-value benchmarks provide one value as output, such as power consumption and average performance. Graph-based benchmarks generate a graph by adjusting one parameter and measuring the value of another one. Examples are clock frequency per workload for a processor and bandwidth per data block size for main memory. 

        \paragraph*{Relation BENCHMARK}
            This is the main benchmark relation. It identifies a single benchmark type by giving it a name, measure unit, description and type (attribute MULTIPLE), which can be 0 for single-value or 1 for graph-based. Depending on the MULTIPLE attribute, the benchmark will be either referenced by the DEVICE\_BENCHMARK or the BENCHMARK\_POINT relations.

        \paragraph*{Relation DEVICE\_BENCHMARK}
            This relation stores one single-value for a benchmark. It also references both the benchmark and the component.
            
        \paragraph*{Relation BENCHMARK\_POINT}
            This relation stores a set of values provided as the output of the benchmark. It also references both the benchmark and the component.            

    \subsubsection*{Relation PRICE}
        Inside the SANDRA's website, in the ``shopping'' area, it is possible to retrieve information about the price and also the MPN of the components. The suggested prices were shown together with a rating. The rating represents the number of users that suggested a price for the component and the higher it is, greater the credibility of the price information.
                        
\subsection{Overview} \label{sec4:analysis_overview}
    % explicar que a gente pegou as coisas e separou por tabelas, tentar nao ser redundate com o que teve no cap3
    % colocar referencia pra tabelas em XXXXXX
    \subsubsection*{Data Insertion into the Database of Components}
        The database of components was created by extracting information from the database provided by SiSoftware Sandra and it contains information about components' characteristics and benchmarks' results. However, this information was not uniformerly stored as represented by Figure~\ref{fig:database_schema} in Appendix~\ref{app:database_schema}, but instead as a set of independent relations without a central component repository. The original schema is described in Appendix~\ref{app:sandra_benchmark_table_schema} and it contains the extracted tables provided by SiSoftware SANDRA.
    
        As SiSoftware Sandra did not provide a centralized component's database, a new relation would have to be created with an association of each component with its respective MPN in order to uniquely identify each component. The method used to that end was explained in section~\ref{sec3:websphinx}.
    
        The steps taken to populate the final database are, as follows:
        \begin{itemize}
            \item The Sandra database information was extracted into the relations shown in Appendix~\ref{app:sandra_benchmark_table_schema}.
            \item The component's MPN relation was created and populated with the output of the procedure described in section~\ref{sec3:websphinx}.
            \item Each component in the extracted Sandra database was assigned to a unique MPN and linked.
            \item The information from the Sandra database was exported to the component database whose schema is in Figure~\ref{fig:database_schema} in Appendix~\ref{app:database_schema}.
        \end{itemize}
    
    \subsubsection*{Measurements and Result Analysis}
        The final task was to compare benchmarks executed in a number of machines and compare their results with measurements with the power measurement device. A standard procedure was defined and then applied to a set of computers. The parameters measured and benchmarked are described in the following paragraphs.
        
        For a deeper study, the measures themselves are in Appendix~\ref{app:measures_toolino}.

        \paragraph*{Measurements}
            For each computer the tool showed in Section~\ref{sec3:energy_measurement_instrument} was used and a measure of three parameters was made:
            \begin{itemize}
                \item The power of the computer with monitor powered on in idle mode, i.e. without running any user processes.
                \item The power of the computer with monitor off also in idle mode.
                \item The power of the computer with monitor on and processor fully stressed while executing a Sandra processor benchmark.
            \end{itemize}
            
            
        \paragraph*{Benchmarking}
            The following Sandra benchmarks were then executed in each computer:
            \begin{itemize}
                \item Processor arithmetic performance benchmark, which provided the power consumption of the processor.
                \item Cache and memory benchmark, which provided the total power consumption of the set processor, chipset and memory.
                \item Physical disk benchmark, that shows the power consumption of the computer's hard drive.
            \end{itemize}
            
            
        \paragraph*{Component Specifications}
            The last set of information used in the benchmark result analysis are the processor specifications (datasheets) provided by the manufacturers.      
                        
            
\section{Results} \label{sec4:results}
This section explains how the obtained data was prepared in order to make the comparisons between the various sources of information and exposes the results together with their analysis.

    \subsection{Data preparation} \label{sec4:data_preparation}

        \paragraph*{Notebook monitor power}
        
            The power consumed by the notebook monitor was estimated as follows: 
            
            \begin{equation}
                \begin{split}
                    \text{ monitor power consumption } =& \text{ power measured with monitor on and idle processor } -  \\
                    & \text{ power measured with monitor off and idle processor }  
                \end{split}
                \label{eq:monitor_consumption}
            \end{equation}
            
        \paragraph*{Idle processor measure}
            Under the hypotheses that: 
            
        \begin{itemize}
            \item Hard disk consumption can be assumed to be low, under 2W in idle mode\footnote{\url{http://www.tomshardware.com/charts/2.5-hard-drive-charts/Idle-Power-Consumption,681.html}}
            \item While not searching for an access point, the notebook wireless card consumes less than 0,5W\footnote{\url{http://www.notebookreview.com/default.asp?newsID=3597&article=wireless+and+battery+power}}
        \end{itemize}
        
            It can be said that the computer power consumption is approximately the sum of the power of the PSU, processor, chipset and memory. This would correspond to the measurements made with the monitor powered off. In the idle processor case, the value was directly measured. 
            
            The Table~\ref{tab:measures_idle} presents the treated measures that were later used in the comparison.
          
            %--TABELA ResultsIdle--
            \begin{table}[htbp]
            \centering
            \begin{tabularx}{\textwidth}{|>{\bfseries}l|>{\centering}X|>{\centering}X|>{\centering}X|}
            \hline
            \bf{Computer Model} & \bf{Measurement Result: \emph{Idle} With Monitor Off (W)} & \bf{Estimated PSU Power$^a$ (W)} & \bf{Measured Power$^b$ (W)} \tnhl
            HPdv3500el & 25.19 & 6.30 & 18.89 \tnhl
            HPdv6580el & 57.14 & 14.29 & 42.86 \tnhl
            Compaq-nx9420 & 74.65 & 18.66 & 55.99 \tnhl
            Acer Aspire 6935g & 33.76 & 8.44 & 25.32 \tnhl
            Acer Aspire 4720z & 39.88 & 9.97 & 29.91 \tnhl
            Acer Aspire 5930G & 39.56 & 9.89 & 29.67 \tnhl
            HP dv6000 & 39.12 & 9.78 & 29.34 \tnhl
            Toshiba & 46.03 & 11.51 & 34.52 \tnhl
            Fujistu AMILO Pa2548 & 55.40 & 13.85 & 41.55 \tnhl
            Samsung Q310 & 26.60 & 6.65 & 19.95 \tnhl
            Acer Aspire 5930G & 32.52 & 8.13 & 24.39 \tnhl
            HP Pavilion dv6000 & 29.38 & 7.35 & 22.04 \tnhl
            Sony Vaio SZ650N & 45.67 & 11.42 & 34.25 \tnhl
            HP Pavilion ze2000 & 31.48 & 7.87 & 23.61 \tnhl
            Sony Vaio v6nfw11e & 29.57 & 7.39 & 22.18 \tnhl
            Asus F3 Series & 38.98 & 9.75 & 29.24 \tnhl
            HP 550 & 33.60 & 8.40 & 25.20 \tnhl
            \end{tabularx}\linebreak
            $^a$ at 75\% Efficiency\linebreak
            $^b$ processor/chipset/memory
            \caption{Measures with Processor in \emph{idle} state}
            \label{tab:measures_idle}
            \end{table}
          
          \paragraph*{Stressed processor measure}
              As the stressed processor measure was only made with the monitor powered on, the estimated monitor power will be subtracted from it as shown in equation~\ref{eq:stressed_withoutmonitor}.
            \begin{equation}
                \begin{split}
                &\text{ consumption with stressed processor } = \\
                &\text{ measured consumption with stressed processor and monitor on }-\\
                &\text{ monitor power consumption }
                \end{split}
                \label{eq:stressed_withoutmonitor}
            \end{equation}

            The Table~\ref{tab:measures_fully_stressed} presents the treated measures that were later used in the comparison.
            
            %--TABELA ResultsStressed--
            \begin{table}[htbp]
            \centering
            \begin{tabularx}{\textwidth}{|>{\bfseries}l|>{\centering}X|>{\centering}X|>{\centering}X|}
            \hline
            \bf{Computer Model} & \bf{Measurement result: \emph{Fully Stressed}$^a$ (W)} & \bf{Estimated PSU Power$^b$ (W)} & \bf{Measured power$^c$ (W)} \tnhl
            HPdv3500el & 32.26 & 8.07 & 24.20 \tnhl
            HPdv6580el & 80.23 & 20.06 & 60.17 \tnhl
            Compaq-nx9420 & 75.40 & 18.85 & 56.55 \tnhl
            Acer Aspire 6935g & 50.48 & 12.62 & 37.86 \tnhl
            Acer Aspire 4720z & 62.59 & 15.65 & 46.94 \tnhl
            Acer Aspire 5930G & 57.91 & 14.48 & 43.43 \tnhl
            HP dv6000 & 54.42 & 13.61 & 40.82 \tnhl
            Toshiba & 56.96 & 14.24 & 42.72 \tnhl
            Fujistu AMILO Pa2548 & 82.52 & 20.63 & 61.89 \tnhl
            Samsung Q310 & 41.55 & 10.39 & 31.16 \tnhl
            Acer Aspire 5930G & 55.59 & 13.90 & 41.69 \tnhl
            HP Pavilion dv6000 & 43.52 & 10.88 & 32.64 \tnhl
            Sony Vaio SZ650N & 74.88 & 18.72 & 56.16 \tnhl
            HP Pavilion ze2000 & 52.34 & 13.09 & 39.26 \tnhl
            Sony Vaio v6nfw11e & 38.87 & 9.72 & 29.15 \tnhl
            Asus F3 Series & 41.68 & 10.42 & 31.26 \tnhl
            HP 550 & 40.40 & 10.10 & 30.30 \tnhl
            \end{tabularx}\linebreak
            $^a$ estimated monitor power
            $^b$ at 75\% efficiency \linebreak
            $^c$processor/chipset/memory
            \caption{Measures with Processor \emph{Fully Stressed}}
            \label{tab:measures_fully_stressed}
            \end{table}

    \subsection{Analysis of results} \label{sec4:analysis_results}

        The results may be divided into two categories: first the comparison between the measured processor consumption by the benchmark and the product specification and secondly the comparison between the cache and memory benchmark and the direct measures.
        
        \paragraph*{Processor power analysis}
            % aqui so se compara a potencia do processador como descrito pelo sandra com a potencia da especificacao. nao se considera PSU nem nada, eh uma comparacao direta. no paragrafo Analysis of the set processor/chipset/memory power consumption se faz o uso da aproximacao do consumo da PSU
            The results of the processor consumption benchmark are compared with their nominal power in Table~\ref{tab:results_spec_processor}. As can be seen in it, the benchmark results are not coherent for five processors, where the measured/estimated processor power is higher than the nominal power determined by their specifications.
            
            %--TABELA ResultsSpecProc--
            \begin{table}[htbp]
            \centering
            \begin{tabularx}{0.9\textwidth}{|>{\bfseries}l|>{\centering}X|>{\centering}X|>{\centering}X|}
            \hline
            \bf{Computer model} & \bf{Benchmark processor power (W)} & \bf{Specification nominal processor power (W)} \tnhl
            HPdv3500el & 19.69 & 25  \tnhl
            HPdv6580el & 32.01 & 35  \tnhl
            Compaq-nx9420 & 26.93 & 31  \tnhl
            Acer Aspire 6935g & 28.03 & 35  \tnhl
            Acer Aspire 4720z & 19.78 & 35  \tnhl
            Acer Aspire 5930G & 25.13 & 25 \tnhl
            HP dv6000 & 25 & 34  \tnhl
            Toshiba & 22.5 & 31  \tnhl
            Samsung Q310 & 26.28 & 25 \tnhl
            Acer Aspire 5930G & 38.6 & 35 \tnhl
            HP Pavilion dv6000 & 12.95 & 35  \tnhl
            Sony Vaio SZ650N & 28.99 & 35  \tnhl
            HP Pavilion ze2000 & 14.62 & 35  \tnhl
            Sony Vaio v6nfw11e & 35.08 & 25  \tnhl
            Asus F3 Series & 12.44 & 35   \tnhl
            HP 550 & 29.63 & 27  \tnhl
            \end{tabularx}
            \caption{Processor Specifications' Results}
            \label{tab:results_spec_processor}
            \end{table}
            
            
        \paragraph*{Analysis of the set processor/chipset/memory power consumption}

            In this analysis the following comparisons were made:
            
            \begin{enumerate}
                \item \bf{Sandra Cache and Memory Benchmark} \emph{versus} \bf{Idle processor with monitor off measurement - PSU estimated power}
                \item \bf{Sandra Cache and Memory Benchmark} \emph{versus} \bf{Stressed processor with monitor on measurement - monitor estimated power - PSU estimated power}
            \end{enumerate}
        
            This analysis was conducted with the processor in idle mode, as shown in Table~\ref{tab:results_final_idle} and with the processor fully stressed, as shown in Table~\ref{tab:results_final_fully_stressed}. The percentage delta was calculated in absolute values taking the measured consumption as the reference, and its average was of 39\% for the idle processor case and of 23\% for the stressed processor case.
            
            %--TABELA ResultsFinalIdle--
            \begin{table}[htbp]
            \centering
            \begin{tabularx}{\textwidth}{|>{\bfseries}l|>{\centering}X|>{\centering}X|>{\centering}X|}
            \hline
            \bf{Computer Model} & \bf{Sandra Benchmark: Measurement of Consumption}$^a$ & \bf{Measured Consumption}$^a$ & \bf{Percentage delta over the measured values} \tnhl
            HPdv3500el & 26.69 & 18.89 & 41\% \tnhl
            HPdv6580el & 40.06 & 42.86 & 7\% \tnhl
            Compaq-nx9420 & 36.16 & 55.99 & 35\% \tnhl
            Acer Aspire 6935g & 35.03 & 25.32 & 38\% \tnhl
            Acer Aspire 4720z & 34.57 & 29.91 & 16\% \tnhl
            Acer Aspire 5930G & 32.13 & 29.67 & 8\% \tnhl
            HP dv6000 & 34.23 & 29.34 & 17\% \tnhl
            Toshiba & 31.24 & 34.52 & 10\% \tnhl
            Samsung Q310 & 33.28 & 19.95 & 67\% \tnhl
            Acer Aspire 5930G & 47.63 & 24.39 & 95\% \tnhl
            HP Pavilion dv6000 & 31.84 & 22.04 & 44\% \tnhl
            Sony Vaio SZ650N & 49.68 & 34.25 & 45\% \tnhl
            HP Pavilion ze2000 & 17.86 & 23.61 & 24\% \tnhl
            Sony Vaio v6nfw11e & 42.08 & 22.18 & 90\% \tnhl
            Asus F3 Series & 28.53 & 29.24 & 2\% \tnhl
            HP 550 & 44.42 & 25.20 & 76\% \tnhl
             &  & \bf{Average delta:} & \bf{39\%} \tnhl
            \end{tabularx}\linebreak
            $^a$ chipset+processor+memory
            \caption{Results for Processor in \emph{Idle} State}
            \label{tab:results_final_idle}
            \end{table}
            
            %--TABELA ResultsFinalStressed--
            \begin{table}[htbp]
            \centering
            \begin{tabularx}{\textwidth}{|>{\bfseries}l|>{\centering}X|>{\centering}X|>{\centering}X|}
            \hline
            \bf{Computer Model} & \bf{Sandra Benchmark: measurement of Consumption}$^a$ & \bf{Measured Consumption}$^a$ & \bf{Percentage delta over the measured values} \tnhl
            HPdv3500el & 26.69 & 24.20 & 10\% \tnhl
            HPdv6580el & 40.06 & 60.17 & 33\% \tnhl
            Compaq-nx9420 & 36.16 & 56.55 & 36\% \tnhl
            Acer Aspire 6935g & 35.03 & 37.86 & 7\% \tnhl
            Acer Aspire 4720z & 34.57 & 46.94 & 26\% \tnhl
            Acer Aspire 5930G & 32.13 & 43.43 & 26\% \tnhl
            HP dv6000 & 34.23 & 40.82 & 16\% \tnhl
            Toshiba & 31.24 & 42.72 & 27\% \tnhl
            Samsung Q310 & 33.28 & 31.16 & 7\% \tnhl
            Acer Aspire 5930G & 47.63 & 41.69 & 14\% \tnhl
            HP Pavilion dv6000 & 31.84 & 32.64 & 2\% \tnhl
            Sony Vaio SZ650N & 49.68 & 56.16 & 12\% \tnhl
            HP Pavilion ze2000 & 17.86 & 39.26 & 55\% \tnhl
            Sony Vaio v6nfw11e & 42.08 & 29.15 & 44\% \tnhl
            Asus F3 Series & 28.53 & 31.26 & 9\% \tnhl
            HP 550 & 44.42 & 30.30 & 47\% \tnhl
             &  & \bf{Average delta:} & \bf{23\%} \tnhl
            \end{tabularx}\linebreak
            $^a$ chipset+processor+memory
            \caption{Results for Processor \emph{Fully Stressed}}
            \label{tab:results_final_fully_stressed}
            \end{table}
        
            
