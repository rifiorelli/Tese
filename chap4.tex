%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Master Thesis - Computer Engineering
%% Copyright 2009 Ricardo Alexandre Fiorelli, Erick Poletto
%% This document is distributed by the terms of the license
%% included in the file LICENCE.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Fourth Chapter
%% Analysis and Results
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Analysis and Results} \label{chap4:analysis_results}
%TODO explicar o que é este capitulo, pra que ele serve, realmente PROCURAR na internet o que geralmente se coloca num capitulo assim
%TODO estudar e escrever o que aprendeu
%
    The objective of this chapter is to describe the designed component's database and evaluate it in comparison with measured data and data obtained from the components' manufacturer. The result of this evaluation will determine the adequacy of power consumption data provided by the database as a way to estimate the power consumption of different machine configurations.
    
\section{Analysis} \label{sec4:analysis}
%TODO here it is explained the database, how it was built, the database schema and etc\ldots
%TODO
\subsection{Component's Database} \label{sec4:component_database}
    The component's database will be described in terms of its relations. For each relation its semantic meaning will be explained along with the included data and the source of this data. The database schema is present in Appendix~\ref{app:database schema}.

%TODO colocar referencias a tabela excel de benchmarks e relations. inserir tabelas no apendice a partir do arquivo characteristics-benchmarks
    \subsubsection*{Relations: Classification}
        For a better understanding of the relations between included in the database it was created a set of categories. The four relation's category used are 1CAT, 2CAT, 3CAT and DEVICE. In this hierarchical disposition each component is classified in three levels by the relations 1CAT, 2CAT and 3CAT and then uniquely identified by the DEVICE relation. This classification follows the one present in the website analyzed by the crawler.

%XXX Seria legal criar uns buletts com
        \paragraph*{Relation 1CAT}%XXX nao entendi o que tem que colocar nessa primeira categoria...
            This is the first level of classification, it is a general one, because it just states the final usage of the component. As the components used in the database are computer components they will be defined like that in this first level.

        \paragraph*{Relation 2CAT}
            This relation fits the component into one of the main devices of a computer architecture. These are the following: processors, main memory, mass storage device, networking devices, CD/DVD player, mainboard, etc.

        \paragraph*{Relation 3CAT}
            The component is classified in the last level to provide contextual information about its usage. Processors, for example, are defined either as boxed or directly available in an OEM computer configuration. Memory can be used for servers, workstations or notebooks. Network devices can be LAN cards or networking equipment such as routers. Finally, mass storage devices are separated by technology, which can be hard-disk or flash-based.

        \paragraph*{Relation DEVICE}
            The last level of these categories is the identification of each component by an unique MPN code. This is the central relation in the database connecting pricing, benchmark and characteristic relations associated to specific components. The MPN information stored here was obtained with the use of the WEBSPHINX crawler over the SiSoftware shopping site. This device relation uses MPN as its key and associates for each component the three previous classifications, the component model/name and the date in which it was inserted in the database.
            
    \subsubsection*{Relations: Characteristics}
        This set of relations associates each component with its specifications, provided by the manufacturer. As SiSoftware Sandra provides these, it was be preferred source for this kind of data. Other sources such as CPU-Z reports and component datasheets were used in case the information could not be found in Sandra.
%TODO referencia no apendice         

        \paragraph*{Relation DEVICE\_CHARACTERISTIC}
            This determines the value of the characteristic being described. The value in CHAR\_VALUE can be for example number of cores or clock frequency for a processor, disk rotation or average bandwidth for a hard drive or size and bandwidth for main memory. The attribute CHAR\_ID is linked to the following relation in order to define the type of the characteristic.
            
        \paragraph*{Relation CHARACTERISTIC}
            Each characteristic, other than a value associated in the previous relation, should be described in terms of type and measurement unit. One example may be the clock frequency which is measured in MHz. In this relation the attribute CHAR\_NAME would be ``clock frequency'', the attribute CHAR\_UM would be ``MHz'' and the DESCRIPTION attribute would explain the meaning of the characteristic.
            
        \paragraph*{Relation SOURCE}
            For each component, the source is the location from which the information was retrieve. For instance, SiSoftware Sandra, the web or other softwares such as CPU-Z.
            
    \subsubsection*{Benchmark Relations}
        In SANDRA there were two types of benchmarks analyzed: single-value or graph-based. Single-value benchmarks provide one value as output, such as power consumption and average performance. Graph-based benchmarks generate a graph by adjusting one parameter and measuring the value of another one. Examples are clock frequency per workload for a processor and bandwidth per data block size for main memory.
%TODO referencia no apendice 

        \paragraph*{Relation BENCHMARK}
            This is the main benchmark relation. It identifies a single benchmark type by giving it a name, measure unit, description and type (attribute MULTIPLE), which can be 0 for single-value or 1 for graph-based. Depending on the MULTIPLE attribute, the benchmark will be either referenced by the DEVICE\_BENCHMARK or the BENCHMARK\_POINT relations.

        \paragraph*{Relation DEVICE\_BENCHMARK}
            This relation stores one single-value for a benchmark. It also references both the benchmark and the component.
            
        \paragraph*{Relation BENCHMARK\_POINT}
            This relation stores a set of values provided as the output of the benchmark. It also references both the benchmark and the component.            

    \subsubsection*{Relation PRICE}
        Inside the SANDRA's website, in the area of ``shopping'', it is possible to retrieve information about the price and also the MPN of the components. The suggested prices were shown together with a rating. The rating represents the number of users that suggested a price for the component and the higher it is, greater the credibility of the price information.
                        
\subsection{Overview} \label{sec4:analysis_overview}
    % explicar que a gente pegou as coisas e separou por tabelas, tentar nao ser redundate com o que teve no cap3
    % colocar referencia pra tabelas em XXXXXX
    \subsubsection*{Data Insertion into the Database of Components}
        The database of components was created by extracting information from the database provided by SiSoftware Sandra and it contains information about component's characteristics and benchmarks' results. However, this information was not uniformerly stored as represented by Figure~\ref{fig:database_schema}, but instead as a set of independent relations without a central component repository. The original schema is described in Appendix~\ref{app:sandra_benchmark_table_schema} and it contains the extracted tables provided by SiSoftware SANDRA.
    
        As SiSoftware Sandra did not provide a centralized component's database, to make the insertion of the new component's database possible a new relation would have to be created with an association of each component with its respective MPN. The method used to that end was explained in section~\ref{sec3:websphinx}.
    
        The steps taken to populate the final database are, as follows:
        \begin{itemize}
            \item The Sandra database information was extracted into the relations shown in Appendix~\ref{app:sandra_benchmark_table_schema}.
            \item The component's MPN relation was created and populated with the output of the procedure described in section~\ref{sec3:websphinx}.
            \item Each component in the extracted Sandra database was assigned to a unique MPN and linked.
            \item The information from the Sandra database was exported to the component database whose schema is in Figure~\ref{fig:database_schema}.
        \end{itemize}
    
    \subsubsection*{Measurements and Result Analysis}
        The final task was to compare benchmarks executed in a number of machines and compare their results with measurements with the power measurement device. A standard procedure was defined and then applied to a set of computers. The parameters measured and benchmarked are described in the following paragraphs.

        \paragraph*{Measurements}
            For each computer the tool showed in Section~\ref{sec3:energy_measurement_instrument} was used and a measure of three parameters was made:
            \begin{itemize}
                \item The power of the computer with monitor powered on in idle mode, i.e. without running any user processes.
                \item The power of the computer with monitor off also in idle mode.
                \item The power of the computer with monitor on and processor fully stressed while executing a Sandra processor benchmark.
            \end{itemize}
            
            The measurement results are described in Appendix~\ref{app:measures_toolino}.
            
        \paragraph*{Benchmarking}
            The following Sandra benchmarks were then executed in each computer:
            \begin{itemize}
                \item Processor arithmetic performance benchmark, which provided the power consumption of the processor.
                \item Cache and memory benchmark, which provided the total power consumption of set processor, chipset and memory.
                \item Physical disk benchmark, that shows the power consumption of the computer's hard drive.
            \end{itemize}
            
            The benchmark results are described in Appendix~\ref{app:measures_toolino}.
            
        \paragraph*{Component Specifications}
            The last set of information used in the benchmark result analysis is the specifications (datasheets) provided by the  manufacturers. 
            % dizer de quais componentes temos os dados na proxima linha
            The specifications of the processor, bla, bla, bla for each computer model can be found in Appendix~\ref{app:measures_toolino}.
                        
            
\section{Results} \label{sec4:results}
%TODO falar que aqui a gente vai explicar os resultados de todos os métodos
%TODO 
\subsection{Benchmark Results} \label{sec4:benchmark_results}

        \paragraph*{Notebook monitor power}
        
            The power consumed by the notebook monitor was estimated as follows: 
            
            \begin{equation}
                \begin{split}
                    \text{ monitor power consumption } =& \text{ power measured with monitor on and idle processor } -  \\
                    & \text{ power measured with monitor off and idle processor }  
                \end{split}
                \label{monitor_consumption}
            \end{equation}
            
        \paragraph*{Idle processor comparison}
            Under the hypotheses that: 
            
        \begin{itemize}
            \item Hard disk consumption can be assumed to be low, under 2W in idle mode\footnote{\url{http://www.tomshardware.com/charts/2.5-hard-drive-charts/Idle-Power-Consumption,681.html}}
            \item While not searching for an access point, the notebook wireless card consumes less than 0,5W\footnote{\url{http://www.notebookreview.com/default.asp?newsID=3597&article=wireless+and+battery+power}}
        \end{itemize}
        
            It can be said that the computer power consumption is approximately the sum of the power of the PSU, processor, chipset and memory. This would correspond to the measurements made with the monitor powered off. In the idle processor case, the value was directly measured. As the stressed processor measure was only made with the monitor powered on, the estimated monitor power will be subtracted from it as shown in equation~\ref{stressed_withoutmonitor}.
            
            \begin{equation}
                \begin{split}
                &\text{ consumption with stressed processor } = \\
                &\text{ measured consumption with stressed processor and monitor on } \\
                &-\text{ monitor power consumption }
                \end{split}
                \label{stressed_withoutmonitor}
            \end{equation}
            
            Finally, the following comparisons were made:

            \begin{enumerate}
                \item \textbf{Sandra Cache and Memory Benchmark} \emph{versus} \textbf{Idle processor with monitor off measurement - PSU estimated power}
-               \item \textbf{Sandra Cache and Memory Benchmark} \emph{versus} \textbf{Stressed processor with monitor on measurement - monitor estimated power - PSU estimated power}
-           \end{enumerate}


